cmake_minimum_required(VERSION 3.16)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

#project name
project(yk)


#--------target--------#

include_directories(src)

find_package(Vulkan REQUIRED)

include_directories(
    src
    src/renderer
    include
    ${Vulkan_INCLUDE_DIRS}
)

set(yk_src "src/yk.c" "src/win32_window.c"  "src/yk_file_reader.c"
           "src/renderer/context.c" "src/renderer/device.c" "src/renderer/swapchain.c" 
           "src/renderer/pipeline.c" "src/renderer/renderer.c")

add_library(${PROJECT_NAME} ${yk_src})
target_link_libraries(${PROJECT_NAME}  ${Vulkan_LIBRARIES})

add_executable(yk_test "src/main.c")
target_link_libraries(yk_test yk )

#---------------------#


#----------copy files----------#

set(files_copied FALSE)

function(copy_directory_if_changed source_dir destination_dir)
    file(GLOB_RECURSE source_files "${source_dir}/*")
    foreach(source_file IN LISTS source_files)
        file(RELATIVE_PATH relative_path "${source_dir}" "${source_file}")
        set(destination_file "${destination_dir}/${relative_path}")

        execute_process(
            COMMAND ${CMAKE_COMMAND} -E copy_if_different "${source_file}" "${destination_file}"
            RESULT_VARIABLE copy_result
        )

        if(NOT copy_result EQUAL 0)
            message(FATAL_ERROR "Error copying file: ${source_file}")
        else()
            set(files_copied TRUE)
        endif()
    endforeach()
endfunction()

copy_directory_if_changed(${CMAKE_CURRENT_SOURCE_DIR}/res ${CMAKE_CURRENT_BINARY_DIR}/res)

if (NOT files_copied)
    message("No files were copied.")
else()
    message("files were copied")
endif()


#|---compile-commands-|

add_custom_target(
    yk_copy-compile-commands ALL
    COMMAND ${CMAKE_COMMAND} -E copy_if_different
        ${CMAKE_BINARY_DIR}/compile_commands.json
        ${CMAKE_CURRENT_LIST_DIR}
)

#|----------------|

#---------------------#